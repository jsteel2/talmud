#extern first_free;

function eve(compiler, f)
(vec{VEC}, x)
{
    first_free = f;
    vec_init(vec, 64, 1);
    while (TRUE)
    {
        input(vec);
        x = compile(compiler, "stdin", vec);
        if (x) x();
    }
}

function input(v)
(eax, unused)
{
    v.[VEC_LEN] = 0;

    do {
        eax = 0;
        interrupt(0x16, &eax, &unused, &unused, &unused, &unused, &unused);
        format(print, "%c", eax & 0xff);
        vec_push1(v, eax);
    } while ((eax & 0xff) != '\r');

    print("\n");
    return v;
}

include "lib/def.kc"
include "lib/util.kc"
include "lib/fs.kc"
include "lib/malloc.kc"
include "lib/map.kc"
include "lib/vec.kc"
include "compiler/compiler.kc"